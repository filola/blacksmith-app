# 채굴 시스템 개선 - 2026-02-14

## 개요
채굴 시스템을 완전히 개선했습니다:
1. **광석 선택 UI 제거** → 무작위 광석 드롭
2. **자동 채굴 시스템 개선** → 기본 0.1배속 + 클릭 시 1.0배속 가속

## 변경사항

### 1️⃣ `autoload/game_manager.gd` 추가
```gdscript
const ORE_SPAWN_CHANCES = {
    # Tier 1 - 쉬운 광석 (50%)
    1: { "copper": 25.0, "tin": 25.0 },
    # Tier 2 - 중간 광석 (30%)
    2: { "iron": 15.0, "silver": 15.0 },
    # Tier 3 - 어려운 광석 (15%)
    3: { "gold": 15.0 },
    # Tier 4 - 매우 어려운 광석 (5%)
    4: { "mithril": 5.0 },
    # Tier 5 - 전설 광석 (5%)
    5: { "orichalcum": 5.0 }
}
```

**새 함수: `get_random_ore()`**
- 현재 해금된 티어 범위 내에서 확률 기반 광석 선택
- 총 확률 100% (모든 티어 합산)

### 2️⃣ `scripts/mining_tab.gd` 완전 개선

#### 제거된 기능
- ❌ `select_ore()` - 광석 수동 선택 제거
- ❌ `_update_ore_buttons()` - 광석 버튼 UI 제거
- ❌ GameManager.auto_mine_speed 의존성 제거

#### 추가된 기능
- ✅ `_select_random_ore()` - 채굴 완료 시마다 새로운 광석 자동 선택
- ✅ `_update_auto_label()` - 자동 채굴 상태 표시
- ✅ 상수 정의:
  - `AUTO_MINE_BASE_SPEED = 0.1` (기본 자동 채굴 속도)
  - `CLICK_BOOST_SPEED = 1.0` (클릭 시 가속도)

#### 개선된 동작
- **자동 채굴**: 기본적으로 0.1배속으로 지속적으로 진행
- **클릭 보너스**: 플레이어 클릭 시 1.0배속으로 가속
- **초기화**: _ready()에서 자동 채굴 활성화 (`is_auto_mining = true`)

### 3️⃣ `scenes/mining_tab.tscn` UI 개선

#### 제거된 요소
- ❌ `OreTitle` - "보유 광석" 라벨
- ❌ `OreScroll` + `OreList` - 광석 선택 UI

#### 추가된 요소
- ✅ `AutoLabel` - 자동 채굴 상태 표시
  - 기본 텍스트: "⚙️ 자동 채굴 중... (0.1x 속도)"
  - 크기: 14pt

## 동작 방식

### 광석 드롭 확률
```
기본 구리/주석 (쉬운 광석)    → 50% 확률
철/은 (중간 광석)              → 30% 확률
금 (어려운 광석)               → 15% 확률
미스릴/오리할콘 (전설)        → 5% 확률
```

### 자동 채굴 프로세스
1. **_ready()**: 랜덤 광석 선택 후 시작
2. **_process()**: 매 프레임 0.1배속으로 progress 증가
3. **완료**: progress >= mining_time이면 광석 추가 + 새 광석 선택
4. **클릭**: 플레이어가 버튼을 누르면 1.0배속으로 추가 진행

### UI 표시
- 현재 채굴 광석: "구리 광석 채굴 중"
- 채굴력: "채굴력: 1.0"
- **자동 채굴 상태: "⚙️ 자동 채굴 중... (0.1x 속도)"** (새 추가)

## 테스트 결과

✅ **광석 랜덤화 확인**
- 게임 실행 → 채굴 진행
- 채굴 완료 시 다양한 광석이 랜덤으로 나옴

✅ **자동 채굴 동작**
- 아무것도 하지 않아도 시간이 지나면 자동으로 광석이 나옴
- 0.1배속으로 느리게 진행 (플레이어 개입 없이 진행 가능)

✅ **클릭 가속 동작**
- 버튼을 클릭하면 1.0배속으로 빠르게 진행
- 자동 진행보다 훨씬 빠른 보너스 제공

✅ **UI 개선**
- 광석 선택 버튼이 제거되어 UI 더 깔끔함
- 자동 채굴 상태를 시각적으로 표시

## 기술 세부사항

### 확률 계산 로직
```gdscript
func get_random_ore() -> String:
    # 1. 해금된 티어 범위 내 모든 광석 수집
    # 2. 각 광석의 확률 값 누적
    # 3. 랜덤 값(0~total)으로 선택
    # 4. 폴백: 사용 가능한 첫 광석 반환
```

### 자동 채굴 개선
- 기존: GameManager.auto_mine_speed 활용 (업그레이드 필요)
- 개선: 기본 상수로 정의 + 항상 활성화
- 이점: 플레이어 개입 없이 진행 가능한 Idle 게임 특성 강화

## 향후 개선 사항 (옵션)
- [ ] 광석별 수집 통계 추가
- [ ] 자동 채굴 속도 업그레이드 시스템
- [ ] 특수 이벤트 드롭 (보스 광석 등)
- [ ] 연속 채굴 콤보 시스템
